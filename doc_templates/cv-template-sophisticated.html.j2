<!DOCTYPE html>
<html lang="{{ 'de-CH' if language == 'de' else 'en' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CV - {{ profile.full_name }}</title>
  {% set font_css_map = {"inter": '"Inter", "Segoe UI", Arial, sans-serif', "roboto": '"Roboto", "Segoe UI", Arial, sans-serif', "lato": '"Lato", "Segoe UI", Arial, sans-serif', "georgia": 'Georgia, "Times New Roman", serif', "source_sans": '"Source Sans 3", "Segoe UI", Arial, sans-serif'} %}
  {% set font_import_map = {"inter": "https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap", "roboto": "https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap", "lato": "https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap", "source_sans": "https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700&display=swap"} %}
  {% set chosen_font = font_css_map.get(theme.font_family, font_css_map["inter"]) %}
  {% set chosen_import = font_import_map.get(theme.font_family, "") %}
  <style>
    {% if chosen_import %}@import url('{{ chosen_import }}');{% endif %}
    @page { size: A4; margin: 10mm 10mm; }
    :root {
      --primary: {{ theme.primary_hex }};
      --accent: {{ theme.accent_hex }};
      --ink: #181c22;
      --muted: #4c5565;
      --panel: {{ theme.card_bg }};
      --rule: {% if theme.border_style == 'none' %}transparent{% else %}#d5dce9{% endif %};
      --radius: {% if theme.border_style == 'rounded' %}10px{% elif theme.border_style == 'square' %}0{% else %}0{% endif %};
      --shadow: {% if theme.box_shadow %}0 2px 8px rgba(0,0,0,0.10){% else %}none{% endif %};
      --page-bg: {{ theme.page_bg }};
    }
    body { margin: 0; font-family: {{ chosen_font }}; color: var(--ink); font-size: 10.2px; line-height: 1.3; background: var(--page-bg); }
    h1,h2,h3,p { margin: 0; }
    .top { overflow: hidden; margin-bottom: 9px; }
    .top .hero { float: left; width: 56%; }
    .top .panel { float: right; width: 42%; }
    .hero, .panel { border: {% if theme.border_style != 'none' %}1px solid var(--rule){% else %}none{% endif %}; border-radius: var(--radius); background: var(--panel); padding: 10px; box-shadow: var(--shadow); }
    .hero h1 { font-size: 25px; color: var(--primary); line-height: 1.02; }
    .hero .headline { margin-top: 4px; font-size: 11px; color: var(--accent); font-weight: 700; }
    .hero .contact { margin-top: 8px; color: var(--muted); font-size: 9.6px; display: block; }
    .hero .contact span { display: block; margin-bottom: 2px; }
    .metrics { display: block; overflow: hidden; }
    .metric { float: left; width: 46%; margin: 0 2% 6px 2%; border-radius: var(--radius); background: var(--panel); border: {% if theme.border_style != 'none' %}1px solid var(--rule){% else %}none{% endif %}; padding: 7px; text-align: center; box-shadow: var(--shadow); }
    .metric strong { font-size: 18px; color: var(--primary); display: block; line-height: 1.05; }
    .layout { overflow: hidden; }
    .col-left { float: left; width: 56%; }
    .col-right { float: right; width: 42%; }
    .section { border: {% if theme.border_style != 'none' %}1px solid var(--rule){% else %}none{% endif %}; border-radius: var(--radius); padding: 8px; background: var(--panel); margin-bottom: 8px; box-shadow: var(--shadow); }
    .section h2 { color: var(--primary); text-transform: uppercase; letter-spacing: 0.6px; font-size: 10.6px; margin-bottom: 4px; }
    .skill-chip { display: inline-block; border: {% if theme.border_style != 'none' %}1px solid var(--rule){% else %}none{% endif %}; border-left: 2px solid var(--primary); border-radius: var(--radius); padding: 2px 5px; margin: 2px 5px 2px 0; background: var(--panel); font-size: 9.2px; box-shadow: var(--shadow); }
    .skill-level { font-size: 8px; color: var(--muted); display: block; margin-top: 1px; }
    .job { margin-bottom: 7px; break-inside: avoid; }
    .job h3 { font-size: 10.5px; line-height: 1.2; }
    .meta { color: var(--muted); font-size: 9px; margin-top: 2px; }
    ul { margin: 4px 0 0 13px; padding: 0; }
    li { margin: 1px 0; }
  </style>
</head>
<body>
  <section class="top">
    <article class="hero">
      <h1>{{ profile.full_name }}</h1>
      <p class="headline">{{ profile.headline }}</p>
      <div class="contact">
        {% if profile.location %}<span>{{ profile.location }}</span>{% endif %}
        {% if profile.email %}<span>{{ profile.email }}</span>{% endif %}
        {% if profile.phone %}<span>{{ profile.phone }}</span>{% endif %}
        {% if profile.linkedin %}<span>{{ profile.linkedin }}</span>{% endif %}
        {% if profile.portfolio %}<span>{{ profile.portfolio }}</span>{% endif %}
      </div>
    </article>
    <article class="panel metrics">
      <div class="metric"><strong>{{ content.experience|length }}</strong><span>{{ "Rollen" if language == "de" else "Roles" }}</span></div>
      <div class="metric"><strong>{{ content.skills|length }}</strong><span>{{ "Skills" if language == "de" else "Skills" }}</span></div>
      <div class="metric"><strong>{{ content.education|length }}</strong><span>{{ "Abschlüsse" if language == "de" else "Degrees" }}</span></div>
      <div class="metric"><strong>{{ "%.0f"|format(match.overall_score) }}</strong><span>ATS</span></div>
    </article>
  </section>

  <section class="layout">
    <div class="col-left">
      <article class="section">
        <h2>{{ "Kurzprofil" if language == "de" else "Profile" }}</h2>
        <p>{{ content.summary }}</p>
      </article>
      <article class="section">
        <h2>{{ "Berufserfahrung" if language == "de" else "Experience" }}</h2>
        {% for item in content.experience %}
          <div class="job">
            <h3>{{ item.role }}{% if item.company %} · {{ item.company }}{% endif %}</h3>
            {% if item.period %}<p class="meta">{{ item.period }}</p>{% endif %}
            {% if item.achievements %}
              <ul>
                {% for achievement in item.achievements %}
                  <li>{{ achievement }}</li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        {% endfor %}
      </article>
    </div>
    <div class="col-right">
      {% if profile.languages %}
      <article class="section" style="background: {{ theme.primary_hex }}08; border-color: {{ theme.primary_hex }}30;">
        <h2>{{ "Sprachen" if language == "de" else "Languages" }}</h2>
        <div style="display: flex; flex-wrap: wrap; gap: 5px;">
          {% for lang in profile.languages %}
            <span style="padding: 3px 7px; background: var(--primary); color: white; border-radius: {% if theme.border_style == 'rounded' %}5px{% else %}2px{% endif %}; font-size: 9px; font-weight: 600;">{{ lang }}</span>
          {% endfor %}
        </div>
      </article>
      {% endif %}
      <article class="section">
        <h2>{{ "Kernkompetenzen" if language == "de" else "Core competencies" }}</h2>
        <div style="display: flex; flex-direction: column; gap: 3px;">
          {% for skill in content.skills %}
            {% set colon_parts = skill.split(': ', 1) %}
            {% if colon_parts|length > 1 %}
              {# NEW FORMAT: "Skill: context" #}
              <div style="padding: 4px 0; border-bottom: 1px solid var(--rule);">
                <div style="font-weight: 600; font-size: 9.6px; color: var(--ink); margin-bottom: 2px;">
                  {{ colon_parts[0] }}
                </div>
                <div style="font-size: 8.2px; color: var(--muted); line-height: 1.3; padding-left: 8px;">
                  {{ colon_parts[1] }}
                </div>
              </div>
            {% else %}
              {# FALLBACK: Old "Skill (Level)" or plain #}
              {% set paren_parts = skill.split(' (') %}
              {% if paren_parts|length > 1 %}
                <div style="padding: 2px 0; border-bottom: 1px solid var(--rule); display: flex; justify-content: space-between;">
                  <span style="font-weight: 600; font-size: 9.6px;">{{ paren_parts[0] }}</span>
                  <span style="font-size: 8.6px; color: var(--muted);">{{ paren_parts[1].rstrip(')') }}</span>
                </div>
              {% else %}
                <div style="padding: 2px 0; border-bottom: 1px solid var(--rule);">
                  <span style="font-weight: 600; font-size: 9.6px;">{{ skill }}</span>
                </div>
              {% endif %}
            {% endif %}
          {% endfor %}
        </div>
      </article>
      <article class="section">
        <h2>{{ "Ausbildung" if language == "de" else "Education" }}</h2>
        {% for item in content.education %}
          <div class="job">
            <h3>{{ item.degree }}</h3>
            <p class="meta">{% if item.school %}{{ item.school }}{% endif %}{% if item.period %} · {{ item.period }}{% endif %}</p>
          </div>
        {% endfor %}
      </article>
      {% if profile.photo_data_url %}
        <article class="section">
          <h2>{{ "Foto" if language == "de" else "Photo" }}</h2>
          <img src="{{ profile.photo_data_url }}" alt="" style="width:100%; max-height:180px; object-fit:cover; border-radius:8px; border:1px solid var(--rule);">
        </article>
      {% endif %}
    </div>
  </section>
</body>
</html>
